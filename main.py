import os

import telebot
from telebot import types

import db.db_init as dbmanager
from util.utils import get_personal_data_menu, get_main_menu, START, HELP, MAIN_MENU, PERSONAL_DATA_MENU, SUPPORT

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç –æ–±'—î–∫—Ç—É
bot = telebot.TeleBot(os.environ.get('BOT_TOKEN'), parse_mode='Markdown')

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
dbmanager.init_db()


@bot.message_handler(commands=[START])
def send_welcome(message):
    bot.send_message(message.chat.id, f'{message.chat.first_name}, –≤—ñ—Ç–∞—î–º–æ –í–∞—Å —É Flying –±–æ—Ç. –¶–µ–π –±–æ—Ç –¥–æ–ø–æ–º–æ–∂–µ –í–∞–º '
                                      f'–ø—Ä–∏–¥–±–∞—Ç–∏ –∞–≤—ñ–∞–∫–≤–∏—Ç–∫–∏‚úàÔ∏è')
    main_menu(message)


@bot.message_handler(commands=[HELP])
def send_help(message):
    bot.send_message(message.chat.id, '–¶–µ–π –±–æ—Ç –º—ñ—Å—Ç–∏—Ç—å —Ç–∞–∫—ñ –∫–æ–º–∞–Ω–¥–∏: \n'
                                            '/start - –ø–æ—á–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–æ—Ç\n'
                                            '/help - –ø–µ—Ä–µ–ª—ñ–∫ –∫–æ–º–∞–Ω–¥, —è–∫—ñ –º—ñ—Å—Ç–∏—Ç—å –≤ —Å–æ–±—ñ –±–æ—Ç\n')


@bot.message_handler(commands=[MAIN_MENU])
def main_menu(message):
    bot.send_message(message.chat.id, '–û–±–µ—Ä—ñ—Ç—å, —â–æ —Ö–æ—á–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏üéÆ', reply_markup=get_main_menu())


@bot.message_handler(commands=[PERSONAL_DATA_MENU])
def personal_data_menu(message):
    bot.send_message(message.chat.id, '–û–±–µ—Ä—ñ—Ç—å –¥—ñ—é –∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏', reply_markup=get_personal_data_menu(message.chat.id))


@bot.callback_query_handler(func= lambda callback: callback.data == PERSONAL_DATA_MENU)
def personal_data_callback(callback):
    personal_data_menu(callback.message)


@bot.callback_query_handler(func= lambda callback: callback.data == SUPPORT)
def support_callback(callback):
    bot.send_message(callback.message.chat.id, '–ó–∞–ª–∏—à–∏–ª–∏—Å—å –ø–∏—Ç–∞–Ω–Ω—è?\n'
                                               '–ó–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –∑–∞ –Ω–æ–º–µ—Ä–æ–º:\n'
                                               '`+380977070505`')


bot.polling(none_stop=True)
